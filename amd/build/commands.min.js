/**
 * Tiny persistentresize commands
 *
 * @module     tiny_persistentresize/commands
 * @copyright  2025 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
import{getButtonImage}from"editor_tiny/utils";import{get_string as getString}from"core/str";import{component,buttonName,clearAllButtonName,icon,iconclearall}from"tiny_persistentresize/common";import Notification from"core/notification";import ModalFactory from"core/modal_factory";import ModalEvents from"core/modal_events";import{getUsername}from"tiny_persistentresize/options";import*as Storage from"tiny_persistentresize/storage";export const getSetup=async()=>{const[t,e,i,o,n,r,a,c,s,m,g]=await Promise.all([getString("menutitle",component),getButtonImage("menuicon",component),getButtonImage("menuclearallicon",component),getString("confirmationtitle",component),getString("confirmationmessage",component),getString("clearallmenutitle",component),getString("clearallconfirmtitle",component),getString("clearallconfirmmessage",component),getString("clearallsuccesstitle",component),getString("clearallsuccessmessage",component),getString("yes","core")]);return l=>{l.ui.registry.addIcon(icon,e.html),l.ui.registry.addIcon(iconclearall,i.html),l.ui.registry.addMenuItem(buttonName,{icon:icon,text:t,onAction:async()=>{const t=l.getElement(),e=getUsername(l),i=`${e}_tiny_persistentresize_height_${t.id}_default`,r=`${e}_tiny_persistentresize_height_${t.id}`;try{const t=await Storage.getItem(i);l.editorContainer.style.height=t,await Storage.removeItem(r),await Storage.removeItem(i),Notification.alert(o,n)}catch(t){Notification.exception(t)}}}),l.ui.registry.addMenuItem(clearAllButtonName,{icon:iconclearall,text:r,onAction:()=>{ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:a,body:c}).then(t=>(t.setSaveButtonText(g),t.getRoot().on(ModalEvents.save,async()=>{try{const t=l.getElement(),e=getUsername(l),i=`${e}_tiny_persistentresize_height_${t.id}_default`,o=await Storage.getItem(i),n=await Storage.getAllKeys(),r=`${e}_tiny_persistentresize_height_`,a=n.filter(t=>t.startsWith(r));await Promise.all(a.map(t=>Storage.removeItem(t))),o&&(l.editorContainer.style.height=o),Notification.alert(s,m)}catch(t){Notification.exception(t)}}),t.show(),t)).catch(Notification.exception)}}),l.on("init",async()=>{const t=l.getElement(),e=getUsername(l),i=`${e}_tiny_persistentresize_height_${t.id}_default`,o=`${e}_tiny_persistentresize_height_${t.id}`;try{await Storage.setItem(i,l.editorContainer.style.height);const t=await Storage.getItem(o);t&&(l.editorContainer.style.height=t)}catch(t){Notification.exception(t)}}),l.on("ResizeEditor",async function(){const t=l.getElement(),e=`${getUsername(l)}_tiny_persistentresize_height_${t.id}`;try{await Storage.setItem(e,l.editorContainer.style.height)}catch(t){Notification.exception(t)}})}};
//# sourceMappingURL=commands.min.js.map