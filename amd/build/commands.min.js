define("tiny_persistentresize/commands",["exports","editor_tiny/utils","core/str","tiny_persistentresize/common","core/notification","core/modal_factory","core/modal_events","tiny_persistentresize/options","tiny_persistentresize/storage"],(function(_exports,_utils,_str,_common,_notification,_modal_factory,_modal_events,_options,Storage){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Tiny persistentresize commands
   *
   * @module     tiny_persistentresize/commands
   * @copyright  2025 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getSetup=void 0,_notification=_interopRequireDefault(_notification),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),Storage=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Storage);_exports.getSetup=async()=>{const[menuTitle,menuImage,menuClearAllImage,confirmationTitle,confirmationMessage,clearAllMenuTitle,clearAllConfirmTitle,clearAllConfirmMessage,clearAllSuccessTitle,clearAllSuccessMessage,yesString]=await Promise.all([(0,_str.get_string)("menutitle",_common.component),(0,_utils.getButtonImage)("menuicon",_common.component),(0,_utils.getButtonImage)("menuclearallicon",_common.component),(0,_str.get_string)("confirmationtitle",_common.component),(0,_str.get_string)("confirmationmessage",_common.component),(0,_str.get_string)("clearallmenutitle",_common.component),(0,_str.get_string)("clearallconfirmtitle",_common.component),(0,_str.get_string)("clearallconfirmmessage",_common.component),(0,_str.get_string)("clearallsuccesstitle",_common.component),(0,_str.get_string)("clearallsuccessmessage",_common.component),(0,_str.get_string)("yes","core")]);return editor=>{let resizeTimeout;editor.ui.registry.addIcon(_common.icon,menuImage.html),editor.ui.registry.addIcon(_common.iconclearall,menuClearAllImage.html),editor.ui.registry.addMenuItem(_common.buttonName,{icon:_common.icon,text:menuTitle,onAction:async()=>{const target=editor.getElement(),username=(0,_options.getUsername)(editor),defaultKey="".concat(username,"_tiny_persistentresize_height_").concat(target.id,"_default"),heightKey="".concat(username,"_tiny_persistentresize_height_").concat(target.id);try{const storedDefaultheight=await Storage.getItem(defaultKey);editor.editorContainer.style.height=storedDefaultheight,await Storage.removeItem(heightKey),await Storage.removeItem(defaultKey),_notification.default.alert(confirmationTitle,confirmationMessage)}catch(error){_notification.default.exception(error)}}}),editor.ui.registry.addMenuItem(_common.clearAllButtonName,{icon:_common.iconclearall,text:clearAllMenuTitle,onAction:()=>{_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:clearAllConfirmTitle,body:clearAllConfirmMessage}).then((modal=>(modal.setSaveButtonText(yesString),modal.getRoot().on(_modal_events.default.save,(async()=>{try{const target=editor.getElement(),username=(0,_options.getUsername)(editor),defaultKey="".concat(username,"_tiny_persistentresize_height_").concat(target.id,"_default"),storedDefaultheight=await Storage.getItem(defaultKey),allKeys=await Storage.getAllKeys(),prefix="".concat(username,"_tiny_persistentresize_height_"),keysToRemove=allKeys.filter((key=>key.startsWith(prefix)));await Promise.all(keysToRemove.map((key=>Storage.removeItem(key)))),storedDefaultheight&&(editor.editorContainer.style.height=storedDefaultheight),_notification.default.alert(clearAllSuccessTitle,clearAllSuccessMessage)}catch(error){_notification.default.exception(error)}})),modal.show(),modal))).catch(_notification.default.exception)}}),editor.on("init",(async()=>{const target=editor.getElement(),username=(0,_options.getUsername)(editor),defaultKey="".concat(username,"_tiny_persistentresize_height_").concat(target.id,"_default"),heightKey="".concat(username,"_tiny_persistentresize_height_").concat(target.id);try{await Storage.setItem(defaultKey,editor.editorContainer.style.height);const storedheight=await Storage.getItem(heightKey);storedheight&&(editor.editorContainer.style.height=storedheight)}catch(error){_notification.default.exception(error)}})),editor.on("ResizeEditor",(async()=>{clearTimeout(resizeTimeout),resizeTimeout=setTimeout((async()=>{const target=editor.getElement(),username=(0,_options.getUsername)(editor),heightKey="".concat(username,"_tiny_persistentresize_height_").concat(target.id);try{await Storage.setItem(heightKey,editor.editorContainer.style.height)}catch(error){_notification.default.exception(error)}}),300)}))}}}));

//# sourceMappingURL=commands.min.js.map