{"version":3,"file":"commands.min.js","sources":["../src/commands.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny persistentresize commands\n *\n * @module     tiny_persistentresize/commands\n * @copyright  2025 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {getButtonImage} from 'editor_tiny/utils';\nimport {get_string as getString} from 'core/str';\nimport {component, buttonName, icon} from 'tiny_persistentresize/common';\nimport Notification from 'core/notification';\n\nexport const getSetup = async() => {\n    const [\n        menuTitle,\n        menuImage,\n        confirmationTitle,\n        confirmationMessage,\n    ] = await Promise.all([\n        getString('menutitle', component),\n        getButtonImage('icon', component),\n        getString('confirmationtitle', component),\n        getString('confirmationmessage', component),\n    ]);\n\n    return (editor) => {\n        // Register the persistentresize icon.\n        editor.ui.registry.addIcon(icon, menuImage.html);\n\n        // Register the Menu item.\n        editor.ui.registry.addMenuItem(buttonName, {\n            icon,\n            text: menuTitle,\n            onAction: () => {\n                const target = editor.getElement();\n                const storedDefaultheight = localStorage.getItem(`tiny_persistentresize_height_${target.id}_default`);\n\n                // Reset to default height and remove stored height preference.\n                // Tiny will handle the actual resize and a null height with a sensible default.\n                editor.editorContainer.style.height = storedDefaultheight;\n                localStorage.removeItem(`tiny_persistentresize_height_${target.id}`);\n                localStorage.removeItem(`tiny_persistentresize_height_${target.id}_default`);\n                // Notify the user.\n                Notification.alert(confirmationTitle, confirmationMessage);\n            },\n        });\n\n        // Restore the editor height from localStorage if it exists.\n        editor.on('init', () => {\n            const target = editor.getElement();\n\n            // Store the default height in case the user wants to reset it later.\n            localStorage.setItem(`tiny_persistentresize_height_${target.id}_default`, editor.editorContainer.style.height);\n\n            const storedheight = localStorage.getItem(`tiny_persistentresize_height_${target.id}`);\n            if (storedheight) {\n                editor.editorContainer.style.height = storedheight;\n            }\n        });\n\n        // Store the editor height in localStorage whenever it is resized.\n        editor.on('ResizeEditor', function() {\n            const target = editor.getElement();\n            localStorage.setItem(`tiny_persistentresize_height_${target.id}`, editor.editorContainer.style.height);\n        });\n    };\n};\n"],"names":["async","menuTitle","menuImage","confirmationTitle","confirmationMessage","Promise","all","component","editor","ui","registry","addIcon","icon","html","addMenuItem","buttonName","text","onAction","target","getElement","storedDefaultheight","localStorage","getItem","id","editorContainer","style","height","removeItem","alert","on","setItem","storedheight"],"mappings":";;;;;;;4KA4BwBA,gBAEhBC,UACAC,UACAC,kBACAC,2BACMC,QAAQC,IAAI,EAClB,mBAAU,YAAaC,oBACvB,yBAAe,OAAQA,oBACvB,mBAAU,oBAAqBA,oBAC/B,mBAAU,sBAAuBA,4BAG7BC,SAEJA,OAAOC,GAAGC,SAASC,QAAQC,aAAMV,UAAUW,MAG3CL,OAAOC,GAAGC,SAASI,YAAYC,mBAAY,CACvCH,KAAAA,aACAI,KAAMf,UACNgB,SAAU,WACAC,OAASV,OAAOW,aAChBC,oBAAsBC,aAAaC,+CAAwCJ,OAAOK,gBAIxFf,OAAOgB,gBAAgBC,MAAMC,OAASN,oBACtCC,aAAaM,kDAA2CT,OAAOK,KAC/DF,aAAaM,kDAA2CT,OAAOK,sCAElDK,MAAMzB,kBAAmBC,wBAK9CI,OAAOqB,GAAG,QAAQ,WACRX,OAASV,OAAOW,aAGtBE,aAAaS,+CAAwCZ,OAAOK,eAAcf,OAAOgB,gBAAgBC,MAAMC,cAEjGK,aAAeV,aAAaC,+CAAwCJ,OAAOK,KAC7EQ,eACAvB,OAAOgB,gBAAgBC,MAAMC,OAASK,iBAK9CvB,OAAOqB,GAAG,gBAAgB,iBAChBX,OAASV,OAAOW,aACtBE,aAAaS,+CAAwCZ,OAAOK,IAAMf,OAAOgB,gBAAgBC,MAAMC"}